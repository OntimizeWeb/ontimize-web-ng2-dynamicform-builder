<div fxLayout="column">
  <mat-tree
    [dataSource]="dataSource"
    [treeControl]="treeControl"
    [id]="uId"
    cdkDropList
    [cdkDropListData]="dataSource.data"
    [cdkDropListConnectedTo]="connectedDropListIds"
    (cdkDropListDropped)="drop($event)">
    
    <!-- This is the tree node template for leaf nodes -->
    <mat-tree-node *matTreeNodeDef="let node" matTreeNodeToggle 
      cdkDrag [cdkDragData]="node">

      <div class="components-tree-drag-preview" *cdkDragPreview></div>

      <li class="component-node">
        <tree-leaf [node]="node" [treeControl]="treeControl" (deleteLeaf)="deleteNode($event)"></tree-leaf>
      </li>
    </mat-tree-node>

    <!-- This is the tree node template for expandable nodes -->
    <mat-nested-tree-node *matTreeNodeDef="let node; when: hasChild" 
      cdkDrag [cdkDragData]="node">
     
      <li fxLayout="column" class="component-node layout-node" matTreeNodeToggle>

        <tree-leaf [node]="node" [treeControl]="treeControl" (deleteLeaf)="deleteNode($event)"></tree-leaf>

        <ul [class.tree-invisible]="!treeControl.isExpanded(node)" 
          [id]="node.uId"
          cdkDropList
          [cdkDropListData]="node.children"
          [cdkDropListConnectedTo]="node.connectedDropListIds"
          (cdkDropListDropped)="drop($event)">
          <ng-container matTreeNodeOutlet></ng-container>
        </ul>
      </li>
    </mat-nested-tree-node>
  </mat-tree>
</div>
