<div fxLayout="column" fxFlex>
  <div fxLayout="row" fxLayoutAlign="start center" class="header" fxLayoutGap="16px">
    <div fxFlex>
      <ng-content select=".o-dynamic-form-builder-header"></ng-content>
    </div>
    <mat-slide-toggle (change)="changeEditionMode($event)" checked="false">
      {{ 'PREVIEW' | odfbTranslate }}
    </mat-slide-toggle>

    <button mat-flat-button color="primary" (click)="save()">{{ 'SAVE' | odfbTranslate }}</button>
  </div>
  
  <mat-sidenav-container fxFlex fxLayout="row">
    <mat-sidenav #leftSidenav mode="side" opened class="left-sidenav">
      <div fxLayout="column" fxFlex fxLayoutGap="24px">
        <components-menu #appMenu fxFlex
          (modeChange)="componentsMenuEditionChange($event)"
          [connectedDropListIds]="componentsMenuConnectedDropListIds"
          [dragEnabled]="isEditionActive">
        </components-menu>

        <components-tree fxFlex #componentsTree
          [form-definition]="formDefinition$ | async"
          (onAddComponent)="onAddComponent($event)"
          (onMoveComponent)="onMoveComponent($event)"
          (onDeleteComponent)="onDeleteComponent($event)"
          (onDrop)="onDrop()"
          (componentSelected)="setSelectedComponent($event)"
          (onChangeComponentSelector)="onChangeComponentSelector($event)"
          (onAddPredefinedLayout)="onAddPredefinedLayout($event)">
        </components-tree>
      </div>
    </mat-sidenav>

    <div fxFlex fxLayout="row" class="dynamic-form-container">
      <o-form #innerForm show-header="false" query-on-init="false" fxFlex>
        <o-dynamic-form #dynamicForm 
          query-on-init="false" 
          register-in-parent-form="false"
          [form-definition]="formDefinition$ | async" 
          [edit-mode]="isEditionActive"

          (onAddComponent)="onAddComponent($event)"
          (onMoveComponent)="onMoveComponent($event)"
          (onDeleteComponent)="onDeleteComponent($event)"
          (onDrop)="onDrop()"
          (onEditComponentSettings)="onEditComponentSettings($event)"
          (onSelectComponent)="onEditComponentSettings($event)"
          (onChangeComponentSelector)="onChangeComponentSelector($event)"
          (onAddPredefinedLayout)="onAddPredefinedLayout($event)"

          (render)="onDynamicFormRendered()">
        </o-dynamic-form>
      </o-form>
    </div>
    

    <mat-sidenav #rightSidenav mode="side" opened position="end" class="right-sidenav">
      <div fxLayout="column" fxFlex>
        <component-properties fxFlex #componentProperties (componentUpdate)="componentUpdated()"></component-properties>
      </div>
    </mat-sidenav>
  </mat-sidenav-container>
  
</div>
